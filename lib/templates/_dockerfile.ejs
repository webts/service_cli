FROM <%- image%>
ENV NODE_ENV=<%- node_env%>

# Set a working directory
WORKDIR /usr/src/app
<% if(copy && copy.length > 0) { %>
COPY <% copy.forEach(function(cpy){ %><%- cpy%> <% }); %> ./
<% } %>
RUN set -ex;\
    if [ "$NODE_ENV"  = "production" ]; then \
    yarn install --production --no-cache --frozen-lockfile; \
    else \
    mkdir -m 777 build\
    yarn install --no-cache --frozen-lockfile; \
    chown -R node:node build node_modules package.json yarn.lock; \
    fi;

USER node

CMD [<%- cmd%>]
