FROM <%- image%>

# Set image metadata
LABEL traefik.port=8080
LABEL traefik.backend="analytics"
LABEL traefik.frontend.rule="PathPrefix:/api/analytics;PathStrip:/api"
LABEL traefik.frontend.priority=100
LABEL traefik.frontend.passHostHeader=true
LABEL traefik.protocol="http,https"

ENV NODE_ENV=<%- node_env%>
ENV PORT=<%- port%>
# Set a working directory

RUN mkdir -p /usr/src/app

WORKDIR /usr/src/app

RUN mkdir build

COPY package.json .

RUN apk add --no-cache --virtual .gyp \
        python \
        make \
        g++ \
    && npm install \
    && apk del .gyp

COPY . .

RUN ls

EXPOSE <%- port %>

USER node

CMD [<%- cmd%>]
