var factory = require('micro-webservice').ServiceFactory;
var fs = require('fs');
var child_process = require('child_process');

var configFile = './run.config.json';

if(fs.existsSync(configFile)){
    try {
        const cf = JSON.parse(fs.readFileSync(configFile).toString());
        cf.root = './build/';
        child_process.exec('yarn install', function(err,stdout, stderr){
            if(err){
                console.error(err);
                return;
            }

            child_process.exec('yarn build', function(err, stdout, stderr){
                const service = factory.buildService(cf);
                if(service !== null)
                    service.start();
            });
        });

    }catch(err){
        console.error(err);
    }
}
else{
    console.log('Configuration file not exists');
}