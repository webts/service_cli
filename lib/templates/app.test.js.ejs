var fs = require('fs');
var child_process = require('child_process');

var configFile = './run.config.json';

if(fs.existsSync(configFile)){
    try {
        const cf = JSON.parse(fs.readFileSync(configFile).toString());
        cf.root = './build/';
        cf.session.host    = 'localhost';
        cf.messageBus.host = 'localhost';
        cf.db.host         = 'localhost';
        cf.port            = 3030;
        child_process.exec('yarn install', function(err,stdout, stderr){
            if(err){
                console.error(err);
                return;
            }

            child_process.exec('yarn build', function(err, stdout, stderr){
                const factory = require('mwservice').ServiceFactory;
                factory.buildService(cf)
                    .then(function(service){
                        if(service !== null)
                            service.start();
                    })
                    .catch(function(err){
                        console.error(err);
                    });
            });
        });

    }catch(err){
        console.error(err);
    }
}
else{
    console.log('Configuration file not exists');
}